<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<template id="web_site_order" inherit_id="website_sale.total">
		
		<xpath expr="//div[@id='cart_total']" position="before">
			<t t-if='website_sale_order.website_id.reward_access_id=="TRUE"'>
			<t t-if="website_sale_order.partner_id.name and 'exp' not in website_sale_order.partner_id.customer_type">
				<table class="table">
	                  <tr id="Your_total_points">
	                      <td class="text-right noborder" >Your total points :</td>
	                      <td class="text-xl-right noborder">
	                          <span t-field="website_sale_order.partner_id.total_points" style="white-space: nowrap;"/>
	                      </td>

	                  </tr>
	                	<tr id="Your_total_amount">
	                  		<td class="text-right noborder" >Your total amount :</td>
	                  		<td class="text-xl-right noborder">
	                          <span t-field="website_sale_order.partner_id[0].total_amount" style="white-space:nowrap;"/>
<!--	                                <t t-esc="website_sale_order.partner_id[0].name"/>-->
                            </td>
	             		</tr>
	                  <tr id="point_to_use">
	                      <td class="text-right noborder">Points to use/redeem:</td>
	                  </tr>
	                    <tr>  
	                      	<td class="text-xl-right noborder" >
	                      	<span>
	                      	<style>
								.align-warning {text-align: center !important;}
							</style>
			                    <t t-if="request.params.get('reward_error_one=1')" name="reward_error1">
									<p class="bg-warning align-warning">Please select redeem percentage and rewards percentage from Rewards Settings</p>
								</t>
								<t t-if="request.params.get('reward_error_two')" name="reward_error2">
									<p class="bg-warning align-warning">Entered point should not exceed than total web points!</p>
								</t>
								<t t-if="request.params.get('reward_error_three')" name="reward_error3">
									<p class="bg-warning align-warning">Point must be positive!</p>
								</t>
								<t t-if="request.params.get('reward_error_four')" name="reward_error4">
									<p class="bg-warning align-warning">Point amount must be less than total amount!</p>
								</t>
								<t t-if="request.params.get('reward_error_five')" name="reward_error5">
									<p class="bg-warning align-warning">Enter Valid Points. Discounted product can not redeem loyalty points!</p>
								</t>
								<t t-if="request.params.get('reward_error_six')" name="reward_error6">
									<p class="bg-warning align-warning">Validity of Redeem Points is Expired!</p>
								</t>
								<t t-if="request.params.get('reward_error_seven')" name="reward_error7">
									<p class="bg-warning align-warning">Enter Integer Value!</p>
								</t>
								<t t-if="request.params.get('reward_error_eight')" name="reward_error8">
									<p class="bg-warning align-warning">You can't redeem point per sale order</p>
								</t>
								<form t-att-action="'/shop/cart/reward'"
								method="post" class="mb32" name="redeem_amount">
									<input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />

									<div class="input-group w-100">
										<input name="point_to_use" class="form-control" 
										type="text" placeholder="points....." t-att-value="0"/>
										<!-- t-att-value="website_sale_order.point_to_use" -->
										<div class="input-group-append" >
											<a href="#" role="button" class="btn btn-secondary a-submit">Ok</a>
										</div>
									</div>
								
								</form>
							</span>
	                      	</td>
	                   </tr>
	            </table>  
	            </t>    
		</t>
		</xpath>
		<xpath expr="//tr[@id='order_total_untaxed']" position="before">
			<t t-if='website_sale_order.website_id.reward_access_id=="TRUE"'>
			<t t-if="website_sale_order.partner_id.name and 'exp' not in website_sale_order.partner_id.customer_type">
				<tr id="selected_redeemable_amount">
                      <td class="text-right noborder">(-)Redeemed Amount:</td>
                      <td class="text-xl-right noborder" >
                          <span t-field="website_sale_order.amount_into_points" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}"/>
                      </td>
                </tr>
			</t>
		</t>
		</xpath>
	
	</template>

	<template id="custom_cart_lines" inherit_id="website_sale.cart_lines">

		<xpath expr="//table[@id='cart_products']" position="replace">
			<table class="mb16 table table-striped table-sm js_cart_lines" id="cart_products" t-if="website_sale_order and website_sale_order.website_order_line">
            <thead>
                <tr>
                    <th class="td-img">Product</th>
                    <th></th>
                    <th class="text-center td-qty">Quantity</th>
                    <th class="text-center td-price">Price</th>
                    <th class="text-center td-action"></th>
                </tr>
            </thead>
            <tbody>
                <t t-foreach="website_sale_order.website_order_line" t-as="line">
                    <tr t-att-class="'optional_product info' if line.linked_line_id else None">
                        <td colspan="2" t-if="not line.product_id.product_tmpl_id" class='td-img'></td>
                        <td align="center" t-if="line.product_id.product_tmpl_id" class='td-img'>
                            <span t-field="line.product_id.image_128" t-options="{'widget': 'image', 'qweb_img_responsive': False, 'class': 'rounded o_image_64_max'}" />
                        </td>
                        <td t-if="line.product_id.product_tmpl_id" class='td-product_name'>
                            <div>
                                <t t-call="website_sale.cart_line_product_link">
                                    <strong t-field="line.name_short" />
                                </t>
                            </div>
                            <t t-call="website_sale.cart_line_description_following_lines">
                                <t t-set="div_class" t-value="'d-none d-md-block'"/>
                            </t>
                        </td>
                        <td class="text-center td-qty">
                            <div class="css_quantity input-group mx-auto">
                                <div class="input-group-prepend">
                                    <a t-attf-href="#" class="btn btn-link js_add_cart_json d-none d-md-inline-block" aria-label="Remove one" title="Remove one">
                                        <i class="fa fa-minus"></i>
                                    </a>
                                </div>
<!--                                <input type="text" class="js_quantity form-control quantity" t-att-data-line-id="line.id" t-att-data-product-id="line.product_id.id" t-att-value="int(line.product_uom_qty) == line.product_uom_qty and int(line.product_uom_qty) or line.product_uom_qty" />-->
                                <t t-if="not line.product_id.id == website_sale_order.get_partner_type_product().id" class="css_quantity input-group mx-auto oe_website_spinner">
                                	<input type="text" class="js_quantity form-control quantity" t-att-data-line-id="line.id" t-att-data-product-id="line.product_id.id" t-att-value="int(line.product_uom_qty) == line.product_uom_qty and int(line.product_uom_qty) or line.product_uom_qty"/>
								</t>
								<t t-else="line.product_id.id == website_sale_order.get_partner_type_product().id" class="css_quantity input-group mx-auto oe_website_spinner">
									<input type="text" class="js_quantity form-control quantity" t-att-data-line-id="line.id" t-att-data-product-id="line.product_id.id" t-att-value="int(line.product_uom_qty) == line.product_uom_qty and int(line.product_uom_qty) or line.product_uom_qty" readonly="1"/>
								</t>
								<div class="input-group-append">
                                    <a t-attf-href="#" class="btn btn-link float_left js_add_cart_json d-none d-md-inline-block" aria-label="Add one" title="Add one">
                                        <i class="fa fa-plus"></i>
                                    </a>
                                </div>
                            </div>
                        </td>
                        <td class="text-center td-price" name="price">
                            <t t-set="combination" t-value="line.product_id.product_template_attribute_value_ids + line.product_no_variant_attribute_value_ids"/>
                            <t t-set="combination_info" t-value="line.product_id.product_tmpl_id._get_combination_info(combination)"/>

                            <t t-set="list_price_converted" t-value="website.currency_id._convert(combination_info['list_price'], website_sale_order.currency_id, website_sale_order.company_id, date)"/>
                            <t groups="account.group_show_line_subtotals_tax_excluded" t-if="(website_sale_order.pricelist_id.discount_policy == 'without_discount' and website_sale_order.currency_id.compare_amounts(list_price_converted, line.price_reduce_taxexcl) == 1) or website_sale_order.currency_id.compare_amounts(line.price_unit, line.price_reduce) == 1" name="order_line_discount">
                                <del t-attf-class="#{'text-danger mr8'}" style="white-space: nowrap;" t-esc="list_price_converted" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" />
                            </t>
                            <span t-field="line.price_reduce_taxexcl" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" groups="account.group_show_line_subtotals_tax_excluded" />
                            <t groups="account.group_show_line_subtotals_tax_included" t-if="(website_sale_order.pricelist_id.discount_policy == 'without_discount' and website_sale_order.currency_id.compare_amounts(list_price_converted, line.price_reduce_taxinc) == 1) or website_sale_order.currency_id.compare_amounts(line.price_unit, line.price_reduce) == 1" name="order_line_discount">
                                <del t-attf-class="#{'text-danger mr8'}" style="white-space: nowrap;" t-esc="list_price_converted" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" />
                            </t>
                            <span t-field="line.price_reduce_taxinc" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" groups="account.group_show_line_subtotals_tax_included" />
                        </td>
                        <td class="td-action">
                            <a href='#' aria-label="Remove from cart" title="Remove from cart" class='js_delete_product no-decoration'> <small><i class='fa fa-trash-o'></i></small></a>
                        </td>
                    </tr>
                </t>
            </tbody>
        </table>
		</xpath>
	</template>

	<template id="custom_cart" inherit_id="website_sale.cart">
		<xpath expr="//t[@t-call='website.layout']" position="replace">
		<t t-call="website.layout">
            <div id="wrap">
                <div class="container oe_website_sale py-2">
                    <div class="row">
                        <div class="col-12">
                            <t t-call="website_sale.wizard_checkout">
                                <t t-set="step" t-value="10" />
                            </t>
                        </div>
                        <div class="col-12 col-xl-8 oe_cart">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div t-if="abandoned_proceed or access_token" class="mt8 mb8 alert alert-info" role="alert"> <!-- abandoned cart choices -->
                                        <t t-if="abandoned_proceed">
                                            <p>Your previous cart has already been completed.</p>
                                            <p t-if="website_sale_order">Please proceed your current cart.</p>
                                        </t>
                                        <t t-if="access_token">
                                            <p>This is your current cart.</p>
                                            <p>
                                                <strong><a t-attf-href="/shop/cart/?access_token=#{access_token}&amp;revive=squash">Click here</a></strong> if you want to restore your previous cart. Your current cart will be replaced with your previous cart.</p>
                                            <p>
                                                <strong><a t-attf-href="/shop/cart/?access_token=#{access_token}&amp;revive=merge">Click here</a></strong> if you want to merge your previous cart into current cart.
                                            </p>
                                        </t>
                                    </div>
                                    <t t-call="website_sale.cart_lines" />
                                    <div class="clearfix" />
                                    <a role="button" href="/shop" class="btn btn-secondary mb32 d-none d-xl-inline-block">
                                        <span class="fa fa-chevron-left" />
                                        <span class="">Continue Shopping</span>
                                    </a>
									<t t-if="website_sale_order.amount_total == 0">
										<div class="alert alert-danger">Invalid Order</div>
									</t>
                                    <a role="button" t-if="website_sale_order and website_sale_order.website_order_line" class="btn btn-primary float-right d-none d-xl-inline-block" href="/shop/checkout?express=1">
                                        <span class="">Process Checkout</span>
                                        <span class="fa fa-chevron-right" />
                                    </a>
                                    <div class="oe_structure" id="oe_structure_website_sale_cart_1"/>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-xl-4" id="o_cart_summary">
                            <t t-call="website_sale.short_cart_summary"/>
                            <div class="d-xl-none mt8">
                                <a role="button" href="/shop" class="btn btn-secondary mb32">
                                    <span class="fa fa-chevron-left" />
                                    Continue<span class="d-none d-md-inline"> Shopping</span>
                                </a>
                                <a role="button" t-if="website_sale_order and website_sale_order.website_order_line" class="btn btn-primary float-right" href="/shop/checkout?express=1">
                                    <span class="">Process Checkout</span>
                                    <span class="fa fa-chevron-right" />
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="oe_structure" id="oe_structure_website_sale_cart_2"/>
            </div>
        </t>
		</xpath>
	</template>

	<template id="custom_portal_layout" inherit_id="portal.portal_layout" name="Custom Portal Layout">
		<xpath expr="//div[@class='o_portal_my_details']" position="after">
			<t t-if="request.env['website'].search([],limit=1).reward_access_id=='TRUE' and 'exp' not in user_id.partner_id.customer_type">
			<t t-if="my_details">
				<h4><i class="fa fa-gift"></i>Total Points:
				<span t-field="user_id.partner_id.total_points"/>
				</h4>
			</t>
			<t t-else="">
				<t t-raw="0"/>
			</t>
			</t>
		</xpath>
	 
	</template>
</odoo>
